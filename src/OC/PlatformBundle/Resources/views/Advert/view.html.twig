{# src/OC/PlatformBundle/Resources/view/Advert/view.html.twig #}

{% extends "OCPlatformBundle::layout.html.twig" %}

{% block title %}
  Lecture d'une annonce - {{ parent() }}
{% endblock %}

{% block ocplatform_body %}

  {# On vérifie qu'une image soit bien associée à l'annonce #}
  {% if advert.image is not null %}
    <img src="{{ vich_uploader_asset(advert.image, 'imageFile') | imagine_filter('my_thumb') }}" alt="{{ advert.title }}" />
    {# <img src="{{ relative_path(vich_uploader_asset(advert, 'imageFile')) }}" alt="{{ advert.title }}" /> #}
  {% endif %}

  <h2>{{ advert.title }}</h2>
  <i>Par {{ advert.author }}, le {{ advert.date|date('d/m/Y') }}</i>

  <div class="well">
    {{ advert.content }}
  </div>

  {% if advert.applications is not empty %}

  <h2>Liste des candidatures pour cette annonce</h2>

    <ul>
      {% for application in advert.applications %}
        <li>
            {{ application.content }}
          par {{ application.author }},
          le {{ application.date|date('d/m/Y') }}
        </li>
      {% endfor %}
    </ul>

  {% endif %}
  
  <br/>

  {% if advert.categories is not empty %}

    <p>
      <b>Cette annonce est parue dans les catégories suivantes :</b><br/>
      {% for category in advert.categories %}
        <i>{{ category.name }}</i>{% if not loop.last %}, {% else %}.{% endif %}
      {% endfor %}
    </p><br/>

  {% endif %}

  <br/>

  {% if advert.skills is not empty %}
    <p>
      <b>Cette annonce requière les compétences suivantes :</b><br/>
      {% for advertSkill in advert.skills %}
        <i><u>{{ advertSkill.skill.name }}</u>, niveau requis : {{ advertSkill.level }}</i>
        {% if not loop.last %}, {% else %}.{% endif %}<br />
      {% endfor %}
    </p><br/>
  {% endif %}

  <p>
    <a href="{{ path('oc_platform_home') }}" class="btn btn-default">
      <i class="glyphicon glyphicon-chevron-left"></i>
      Retour à la liste
    </a>
    <a href="{{ path('oc_platform_edit', {'id': advert.id}) }}" class="btn btn-default">
      <i class="glyphicon glyphicon-edit"></i>
      Modifier l'annonce
    </a>
    <a href="#" class="btn btn-danger" data-toggle="modal" data-target="#confirm-delete">
      <i class="glyphicon glyphicon-trash"></i>
      Supprimer l'annonce
    </a>
  </p>

  <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="myModalLabel">Confirmation suppression</h4>
                </div>
                <div class="modal-body">
                    <p>Etes vous sûr de vouloir supprimer l'annonce<b> <i class="title">{{ advert.title }}</i></b> ?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                    <a href="{{ path('oc_platform_delete', {'id': advert.id}) }}" type="button" class="btn btn-danger btn-ok">Je confirme, supprimer l'annonce</a>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts %}

  <script data-require="jquery@*" data-semver="2.0.3" src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
  <script data-require="bootstrap@*" data-semver="3.1.1" src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  <script>
        $('#confirm-delete').on('click', '.btn-ok', function(e) {
            var $modalDiv = $(e.delegateTarget);
            var id = $(this).data('recordId');
            // $.ajax({url: '/api/record/' + id, type: 'DELETE'})
            // $.post('/api/record/' + id).then()
            $modalDiv.addClass('loading');
            setTimeout(function() {
                $modalDiv.modal('hide').removeClass('loading');
            }, 1000)
        });
        $('#confirm-delete').on('show.bs.modal', function(e) {
            var data = $(e.relatedTarget).data();
            $('.title', this).text(data.recordTitle);
            $('.btn-ok', this).data('recordId', data.recordId);
        });
    </script>

    {{ parent() }}

{% endblock %}
